<div id="explore-color" class="container fullheight search-page">

  <% if params[:category_id].present? %>
    <div class="my-4 page-title">
      <h1 class="<%= @category.name.downcase %>-color"><%= @category.name %><i class="fa-solid fa-bolt icon-logo"></i></h1>
    </div>

  <form novalidate="novalidate" class="simple_form search" action="<%= tois_path %>" accept-charset="UTF-8" method="get">
    <% if params[:category_id].present? %>
      <input type="hidden" name="category_id" value="<%= params[:category_id] %>" />
    <% end %>
    <div class="search-form-control form-group">
      <input class="form-control string required" type="text" name="query" id="search_query" placeholder="Rechercher par mot-clÃ©" />
        <button type="submit" class="btn btn-flat">
          <i class="fas fa-search"></i>
        </button>
      </div>
    </form>
    <%=average = 0 %>


    <% @tois.each_with_index do |toi, index| %>
      <%= link_to toi_path(toi) do %>
        <div id="avatar-size" class="card <%= @category.name.downcase %>-border">
          <div class="p-1">
            <%= cl_image_tag toi.photo.key, height: 300, crop: :fill, class: "img-toi" %>
            <h2 class="fw-bold"><%= toi.title %></h2>

            <% if toi.posts.last %>
              <div class="d-flex flex-row justify-content-between">
                <strong><%= toi.posts.count %> avis</strong>
                <div class="stars text-primary color-star">
                  <p>
                  <strong>

                      <% Post.where(toi_id: toi.id).each do |note| %>
                        <% average += note.rating %>
                      <% end %>
                      <%= (average / Post.where(toi_id: toi.id).length).fdiv(2).round(1)%>/5</strong></p>
                      <%=toi.starify_average(current_user).html_safe %>
                      <% average = 0 %>





                </div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    <% end %>

  <% else %>
  <div class="my-5 page-title">
    <h1>Explore<i class="fa-solid fa-bolt icon-logo"></i></h1>
  </div>

     <% Category.all.each_with_index do |cat, index| %>
       <div id="avatar-size" class="card <%= cat.name.downcase %>">
         <%= link_to cat.name, tois_path(category_id: cat.id), class: 'fw-bold text-black h3' %>
       </div>
     <% end %>

  <% end %>

</div>
